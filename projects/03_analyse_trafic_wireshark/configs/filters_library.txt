# ===============================================================
# üîç Biblioth√®que de Filtres Wireshark pour Cybers√©curit√©
# ===============================================================
# 
# Ce fichier contient une collection compl√®te de filtres Wireshark
# organis√©s par cat√©gorie pour l'analyse de s√©curit√© professionnelle.
#
# Usage: Copier-coller les filtres dans Wireshark ou utiliser
#        comme r√©f√©rence pour l'automatisation avec tshark.
#
# ===============================================================

# === FILTRES DE CAPTURE (BPF - Berkeley Packet Filter) ===

## Capture par Protocole
tcp port 80 or tcp port 443                    # Trafic Web HTTP/HTTPS
udp port 53 or tcp port 53                     # Trafic DNS
tcp port 22 or tcp port 23                     # SSH/Telnet
tcp port 25 or tcp port 587 or tcp port 465    # SMTP/Email
tcp port 110 or tcp port 995                   # POP3
tcp port 143 or tcp port 993                   # IMAP
tcp port 445 or tcp port 139                   # SMB/NetBIOS
tcp port 3389                                  # RDP Windows
tcp port 1433 or tcp port 3306 or tcp port 5432 # Bases de donn√©es

## Capture par Direction
src net 192.168.0.0/16                        # Trafic sortant r√©seau priv√©
dst net 192.168.0.0/16                        # Trafic entrant r√©seau priv√©
not (src net 192.168.0.0/16 or dst net 192.168.0.0/16) # Trafic externe uniquement

## Capture par Type de Trafic
tcp[tcpflags] & (tcp-syn) != 0                # Paquets SYN (connexions)
tcp[tcpflags] & (tcp-rst) != 0                # Paquets RST (r√©initialisations)
icmp                                          # Tout le trafic ICMP
greater 1500                                  # Paquets > 1500 bytes

# === FILTRES D'AFFICHAGE POUR D√âTECTION D'INTRUSION ===

## Reconnaissance et Scans
tcp.flags.syn == 1 and tcp.flags.ack == 0             # Paquets SYN (scan potentiel)
tcp.analysis.flags                                     # Anomalies TCP d√©tect√©es
icmp.type == 8 and icmp.code == 0                    # Ping requests
tcp.flags.reset == 1                                  # Connexions ferm√©es brutalement
tcp.port in {1..1024} and tcp.flags.syn == 1         # Scan ports privil√©gi√©s

## Activit√©s Web Malveillantes
http.request.uri contains "../"                       # Directory traversal
http.request.uri contains "script"                    # XSS potentiel
http.request.uri contains "union"                     # SQL injection
http.request.uri contains "select"                    # SQL injection
http.request.uri contains "drop"                      # SQL injection
http.request.uri contains "exec"                      # Command injection
http.request.uri contains "cmd"                       # Command injection
http.request.uri matches ".*[<>\"'].*"               # Caract√®res suspects
http.user_agent contains "python"                     # Scripts automatis√©s
http.user_agent contains "wget"                       # Outils de t√©l√©chargement
http.user_agent contains "curl"                       # Outils de t√©l√©chargement
http.user_agent contains "nikto"                      # Scanner de vuln√©rabilit√©s
http.user_agent contains "sqlmap"                     # Outil d'injection SQL
http.user_agent == ""                                 # User-Agent vide (suspect)

## Analyse DNS Avanc√©e
dns.qry_name contains "."                             # Toutes les requ√™tes DNS
dns.flags.response == 0                               # Requ√™tes uniquement
dns.flags.response == 1                               # R√©ponses uniquement
dns.flags.rcode != 0                                  # Erreurs DNS
dns.qry_name matches "([a-z0-9]{20,}\.)+[a-z]{2,}"  # Domaines DGA suspects
frame.len > 512 and dns                               # Requ√™tes DNS volumineuses
dns.qry_name contains "base64"                        # Tunneling DNS potentiel
dns.count.queries > 1                                 # Requ√™tes multiples

## Trafic Chiffr√© Suspect
tls.handshake.type == 1                               # Client Hello TLS
ssl.record.content_type == 23                         # Application Data SSL
tls.handshake.extensions_server_name                  # SNI TLS
ssl.record.length > 16384                             # Gros paquets SSL
tls.alert_message                                     # Alertes TLS (erreurs)

## Communication Command & Control
tcp.len > 0 and tcp.payload                           # Paquets avec payload
tcp.payload contains "base64"                         # Donn√©es encod√©es
tcp.stream eq X and tcp.len > 100                     # Session sp√©cifique (remplacer X)
http.content_length > 1000000                         # Gros t√©l√©chargements
ftp-data                                              # Transferts FTP

## D√©tection d'Exfiltration
tcp.len > 1460 and tcp.flags.push == 1               # Gros paquets avec PUSH
tcp.analysis.bytes_in_flight > 65536                 # Beaucoup de donn√©es en transit
tcp.stream eq X and frame.time_delta > 60            # Sessions longues
tcp.payload matches "[\x00-\x08\x0E-\x1F\x7F-\xFF]{10,}" # Donn√©es binaires

# === FILTRES POUR FORENSIQUE ET TIMELINE ===

## Filtres Temporels
frame.time >= "2024-01-01 00:00:00"                  # Depuis une date
frame.time_delta > 10                                # D√©lai > 10 secondes
tcp.time_delta > 5                                   # D√©lai TCP > 5 secondes

## Analyse d'Incident Sp√©cifique
ip.addr == 192.168.1.100                             # Adresse IP sp√©cifique
tcp.stream eq 42                                     # Session TCP sp√©cifique
http.host == "malicious.example.com"                 # Domaine suspect
dns.qry_name == "evil.domain.com"                    # Domaine malveillant

## Reconstruction de Sessions
tcp.stream eq X                                       # Session compl√®te
tcp.stream eq X and (tcp.flags.syn == 1 or tcp.flags.fin == 1) # D√©but/fin session
follow tcp.stream eq X                               # Suivi de flux

# === FILTRES POUR ANALYSE DE MALWARE ===

## Communication Malware
tcp.payload contains "MZ"                            # Ex√©cutables Windows
tcp.payload contains "PE"                            # Headers PE
http.request.uri contains ".exe"                     # T√©l√©chargement d'ex√©cutables
http.content_type contains "application/octet-stream" # Fichiers binaires
smtp.data.fragment contains "malware"                # Emails avec malware

## Indicateurs Comportementaux
tcp.analysis.retransmission                          # Retransmissions (r√©seau instable)
tcp.analysis.duplicate_ack                           # ACK dupliqu√©s
tcp.analysis.out_of_order                            # Paquets d√©sordonn√©s
tcp.analysis.fast_retransmission                     # Retransmission rapide

# === FILTRES AVANC√âS ET COMBIN√âS ===

## D√©tection Multi-Crit√®res
(http.request.uri contains "admin" or http.request.uri contains "login") and http.response.code >= 400
# Tentatives d'acc√®s admin √©chou√©es

(tcp.flags.syn == 1 and tcp.flags.ack == 0) and tcp.window_size <= 1024
# Scan de ports avec petite fen√™tre

dns.qry_name and frame.len > 512 and not dns.flags.response
# Requ√™tes DNS volumineuses sans r√©ponse

## Analyse G√©ographique (n√©cessite GeoIP)
ip.geoip.src_country != "FR" and tcp.dstport == 22
# Connexions SSH depuis l'√©tranger

ip.geoip.dst_country in {"CN", "RU", "KP"}
# Trafic vers pays suspects

## Performance et Optimisation
tcp.analysis.ack_rtt > 1.0                           # RTT √©lev√© (> 1 seconde)
tcp.analysis.initial_rtt > 0.5                       # RTT initial √©lev√©
tcp.window_size_value < 8192                         # Petite fen√™tre TCP

# === MACROS POUR INVESTIGATIONS SP√âCIALIS√âES ===

## Investigation d'Attaque Web Compl√®te
(http.request.method == "POST" and http.content_length > 1000) or 
(http.request.uri contains "admin" and http.response.code >= 400) or
(http.request.uri matches ".*(\.\./|script|union|select).*")

## Investigation Malware Communication
(tcp.payload contains "base64" or tcp.payload matches "[A-Za-z0-9+/]{20,}") and
not (http or dns or dhcp) and tcp.len > 100

## Investigation Data Exfiltration
(tcp.len > 1000 and tcp.flags.push == 1) or
(ftp.command.arg contains "/" and ftp.response.code == 226) or
(http.content_length > 10000000)

## Investigation Scan et Reconnaissance
(tcp.flags.syn == 1 and tcp.flags.ack == 0 and tcp.window_size <= 1024) or
(icmp.type == 8 and data.len > 64) or
(tcp.dstport in {1..1024} and tcp.flags.reset == 1)

# === FILTRES PAR ENVIRONNEMENT ===

## Environnement Windows
smb or smb2 or nbns or dcerpc or kerberos or ldap or ntlmssp
tcp.port == 135 or tcp.port == 445 or tcp.port == 139 or tcp.port == 88

## Environnement Linux/Unix
ssh or tcp.port == 22 or tcp.port == 514 or udp.port == 514
tcp.port == 25 or tcp.port == 80 or tcp.port == 443

## Environnement Industrial (ICS/SCADA)
modbus or dnp3 or iccp or bacnet or enip
tcp.port == 502 or tcp.port == 20000 or tcp.port == 102

# === FILTRES POUR COMPLIANCE ET AUDIT ===

## Trafic Chiffr√© vs Non-Chiffr√©
ssl or tls                                            # Tout le trafic chiffr√©
not (ssl or tls) and tcp.port in {21,23,25,53,80,110,143} # Trafic non chiffr√© sur ports sensibles

## Acc√®s aux Donn√©es Sensibles
http.request.uri contains "database" or http.request.uri contains "backup"
smb.path contains "confidential" or smb.path contains "admin"

## Monitoring Conformit√©
tcp.port == 21 and not tls                           # FTP non s√©curis√©
tcp.port == 23                                       # Telnet (non s√©curis√©)
tcp.port == 25 and not tls                           # SMTP non chiffr√©

# === NOTES D'UTILISATION ===

# ATTENTION:
# - Remplacer X par le num√©ro de stream appropri√© dans tcp.stream eq X
# - Adapter les adresses IP selon votre environnement
# - Les filtres peuvent √™tre combin√©s avec des op√©rateurs logiques: and, or, not
# - Utiliser les parenth√®ses pour grouper les conditions complexes
# - Certains filtres n√©cessitent des bases de donn√©es GeoIP configur√©es

# PERFORMANCE:
# - Les filtres regex (matches) sont plus lents que les comparaisons simples
# - Utiliser les filtres de capture (BPF) pour r√©duire le volume avant analyse
# - √âviter les filtres trop complexes sur de gros fichiers

# EXEMPLES DE COMBINAISONS:
# Trafic web suspect depuis l'externe:
# http and not (ip.src >= 192.168.0.0 and ip.src <= 192.168.255.255) and 
# (http.request.uri contains "admin" or http.user_agent contains "python")

# Sessions TCP anormalement longues avec beaucoup de donn√©es:
# tcp.stream eq X and frame.time_relative > 300 and tcp.len > 1000

# ===============================================================
# Fin de la biblioth√®que de filtres
# Derni√®re mise √† jour: 2024
# ===============================================================