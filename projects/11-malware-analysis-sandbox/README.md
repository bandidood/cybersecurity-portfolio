# ğŸ¦  Malware Analysis Sandbox

## Project Overview

A functional malware analysis platform for static analysis of malicious software. This toolkit provides automated file analysis, PE structure parsing, IOC extraction, YARA rule scanning, and comprehensive report generation - all without executing potentially dangerous code.

**Status**: 75% Complete | **Type**: Analysis Tool | **Language**: Python | **LOC**: ~3,500

## ğŸ¯ Objectives Achieved

- âœ… **Static Analysis**: Complete PE file format analysis
- âœ… **IOC Extraction**: Automated indicator detection (IPs, URLs, emails, registry keys)
- âœ… **YARA Scanning**: Malware signature detection
- âœ… **Threat Scoring**: Multi-factor threat assessment
- âœ… **Sample Management**: Secure storage and organization
- âœ… **Report Generation**: Text, Markdown, and JSON formats
- âœ… **CLI Tool**: Command-line interface for automation
- âœ… **Packer Detection**: Entropy-based packing identification

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Client Applications                 â”‚
â”‚   CLI Tool  â”‚  Python API  â”‚  Report Generator   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Analysis Engines                       â”‚
â”‚  Static Analyzer  â”‚  YARA Scanner                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Sample Management System                 â”‚
â”‚  Pending  â”‚  Analyzed  â”‚  Quarantine             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Features Implemented

### Static Analysis Engine
- **File Type Detection**: PE, ELF, Mach-O, scripts, documents
- **Hash Calculation**: MD5, SHA1, SHA256
- **PE Analysis**:
  - Architecture and subsystem detection
  - Section analysis with entropy calculation
  - Import/Export table extraction
  - Resource enumeration
  - Packer detection (UPX, ASPack, PECompact, MPRESS)
- **String Extraction**:
  - ASCII and Unicode strings
  - URL and IP extraction
  - Email address detection
  - Registry key identification
  - File path extraction
  - Suspicious string classification
- **Threat Scoring**: Automated threat level assessment (0-100 scale)

### YARA Scanner
- Load rules from files or directories
- File and data buffer scanning
- Extract matched strings with offsets
- 5 default rule sets included:
  - Ransomware indicators
  - Backdoor indicators
  - Keylogger indicators
  - Packed executables
  - Suspicious API usage

### Sample Manager
- Secure sample storage by status (pending/analyzed/quarantine)
- Metadata tracking (JSON-based)
- Search and filter by tags, status, keywords
- Import/export capabilities
- Statistics and aggregations
- Quarantine for high-risk samples

### Report Generator
- **Text Format**: Detailed, human-readable reports
- **Markdown Format**: Documentation-friendly output
- **JSON Format**: Machine-readable for automation
- Comprehensive sections: executive summary, PE details, IOCs, YARA matches, threat assessment

### CLI Tool
```bash
analyze <file>      # Perform static analysis
import <file>       # Import sample into sandbox
list                # List all samples
search <query>      # Search samples by keyword
report <id>         # Generate report for sample
yara scan <file>    # Scan with YARA rules
yara init           # Initialize default rules
stats               # Show sandbox statistics
delete <id>         # Remove sample
```

## ğŸš€ Quick Start

### Installation

```bash
# Navigate to project directory
cd projects/11-malware-analysis-sandbox

# Install dependencies
pip install -r requirements.txt

# Initialize YARA rules
python src/cli.py yara init --output rules/
```

### Run Demo

```bash
# Run comprehensive demonstration
python examples/demo.py
```

### Analyze a File

```bash
# Basic analysis
python src/cli.py analyze suspicious.exe --output report.txt

# Analysis with YARA scanning
python src/cli.py analyze malware.dll --yara-rules rules/ --import

# Generate detailed report
python src/cli.py analyze sample.exe --format markdown --output analysis.md
```

## ğŸ“– Usage Examples

### CLI Usage

```bash
# Analyze and import a sample
python src/cli.py analyze malware.exe --yara-rules rules/ --import

# List all analyzed samples
python src/cli.py list --status completed

# Search for ransomware samples
python src/cli.py search ransomware

# Generate report for specific sample
python src/cli.py report <sample_id> --format markdown --output report.md

# YARA scan a file
python src/cli.py yara scan suspicious.exe --rules rules/

# Show sandbox statistics
python src/cli.py stats

# Delete a sample
python src/cli.py delete <sample_id>
```

### Python API

```python
from src.analyzers.static_analyzer import StaticAnalyzer
from src.scanners.yara_scanner import YARAScanner
from src.utils.sample_manager import SampleManager
from src.utils.report_generator import ReportGenerator

# Static analysis
analyzer = StaticAnalyzer()
result = analyzer.analyze_file('malware.exe')

print(f"Threat Level: {result.threat_level.value}")
print(f"Threat Score: {result.threat_score}/100")
print(f"Indicators: {result.indicators}")

# YARA scanning
scanner = YARAScanner('rules/')
matches = scanner.scan_file('malware.exe')
for match in matches:
    print(f"Rule: {match.rule_name}, Tags: {match.tags}")

# Sample management
manager = SampleManager()
sample = manager.import_sample(
    'malware.exe',
    tags=['ransomware', 'high-priority'],
    notes='Received from SOC team'
)

# Report generation
ReportGenerator.save_report(sample, 'report.txt', format='text')
```

## ğŸ› ï¸ Technologies Used

### Core Framework
- **Python 3.9+**: Modern Python with type hints
- **pefile**: PE file format parsing
- **python-magic**: File type detection
- **yara-python**: YARA rule scanning

### Analysis Capabilities
- **Entropy Calculation**: Shannon entropy for packer detection
- **Regex Patterns**: IOC extraction
- **Hash Algorithms**: MD5, SHA1, SHA256
- **String Extraction**: ASCII and Unicode

## ğŸ“š Project Structure

```
11-malware-analysis-sandbox/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models.py                    # Data models (350 LOC)
â”‚   â”œâ”€â”€ analyzers/
â”‚   â”‚   â””â”€â”€ static_analyzer.py       # Static analysis engine (650 LOC)
â”‚   â”œâ”€â”€ scanners/
â”‚   â”‚   â””â”€â”€ yara_scanner.py          # YARA scanner (300 LOC)
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ sample_manager.py        # Sample management (350 LOC)
â”‚   â”‚   â””â”€â”€ report_generator.py      # Report generation (450 LOC)
â”‚   â””â”€â”€ cli.py                        # CLI interface (400 LOC)
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ demo.py                      # Demo script (350 LOC)
â”œâ”€â”€ samples/                          # Sample storage (auto-created)
â”œâ”€â”€ reports/                          # Generated reports
â”œâ”€â”€ rules/                            # YARA rules
â”œâ”€â”€ README.md                         # This file
â”œâ”€â”€ PROJECT_STATUS.md                 # Detailed status
â””â”€â”€ requirements.txt                  # Dependencies

Total: ~3,500 lines of Python code
```

## ğŸ“ Learning Outcomes

### Malware Analysis Concepts
- Static analysis methodologies
- PE file format internals
- IOC extraction techniques
- YARA rule development
- Packer detection
- Threat scoring algorithms
- Malware family classification

### Technical Skills
- File format parsing
- Binary analysis
- Pattern matching and regex
- Entropy calculation
- Secure file handling
- CLI tool development
- Report generation systems

### Security Practices
- Safe malware handling
- No-execution analysis
- Sample isolation
- IOC identification
- Threat assessment
- Automated analysis workflows

## ğŸ” Key Components

### File Types Supported
- **PE Executables**: Windows .exe, .dll
- **Scripts**: .py, .js, .vbs, .ps1, .sh, .bat
- **Documents**: .doc, .docx, .pdf (metadata only)
- **Archives**: .zip, .rar, .7z
- **ELF**: Linux binaries (basic detection)
- **Mach-O**: macOS binaries (basic detection)

### IOC Types Extracted
- IP addresses (IPv4)
- URLs (HTTP/HTTPS)
- Email addresses
- Windows registry keys
- File paths (Windows and Unix)
- Cryptographic constants

### Threat Levels
- **Benign**: Score 0-25
- **Suspicious**: Score 25-50
- **Malicious**: Score 50-75
- **Highly Malicious**: Score 75-100

## ğŸ“Š Statistics & Metrics

### Code Metrics
- **Total LOC**: ~3,500 Python
- **Functions**: 80+
- **Classes**: 13
- **Data Models**: 8
- **CLI Commands**: 8

### Capabilities
- **File Types**: 6 categories
- **Hash Algorithms**: 3 (MD5, SHA1, SHA256)
- **YARA Rules**: 5 default sets
- **Report Formats**: 3 (text, markdown, JSON)
- **IOC Types**: 6+

## ğŸ”„ Integration Examples

### SOC Workflow

```python
# Automated triage workflow
from src.analyzers.static_analyzer import StaticAnalyzer
from src.scanners.yara_scanner import YARAScanner

def triage_sample(filepath):
    """Automated sample triage"""
    # Static analysis
    analyzer = StaticAnalyzer()
    result = analyzer.analyze_file(filepath)

    # YARA scanning
    scanner = YARAScanner('rules/')
    matches = scanner.scan_file(filepath)

    # Decision logic
    if result.threat_score > 75 or matches:
        return "CRITICAL - Immediate investigation required"
    elif result.threat_score > 50:
        return "HIGH - Schedule for detailed analysis"
    else:
        return "LOW - Standard monitoring"
```

### Threat Intelligence

```python
# Extract IOCs for sharing
def extract_iocs_for_sharing(sample_id):
    """Extract IOCs for threat intelligence sharing"""
    manager = SampleManager()
    sample = manager.get_sample(sample_id)

    if sample and sample.static_analysis:
        iocs = {
            'hashes': {
                'md5': sample.file_info.md5,
                'sha1': sample.file_info.sha1,
                'sha256': sample.file_info.sha256
            },
            'network': {
                'urls': sample.static_analysis.string_analysis.urls,
                'ips': sample.static_analysis.string_analysis.ips
            },
            'family': sample.malware_family,
            'threat_level': sample.threat_level.value
        }
        return iocs
```

## ğŸ“ Documentation

- **[PROJECT_STATUS.md](PROJECT_STATUS.md)**: Detailed project status
- **[examples/demo.py](examples/demo.py)**: Complete demonstration

## ğŸ”’ Security Considerations

- **No Execution**: Static-only analysis, no code execution
- **Isolated Storage**: Samples stored in separate directories
- **Quarantine**: High-risk samples can be isolated
- **Safe Operations**: All file operations are read-only
- **Type Validation**: File types validated before analysis
- **Hash Verification**: Integrity checking with multiple hashes

## ğŸš§ Known Limitations

- **Static-only**: No dynamic/behavioral analysis
- **PE Focus**: Full analysis only for PE files (ELF/Mach-O basic)
- **No Unpacking**: Packed samples not automatically unpacked
- **No Disassembly**: Code disassembly not included
- **Memory Analysis**: No memory dump analysis
- **Network Analysis**: No traffic capture

## ğŸ”„ Future Enhancements

### Short Term
- Unit tests with pytest
- ELF and Mach-O full analysis
- Office document analysis (oletools)
- Archive extraction and analysis
- More YARA rule sets

### Medium Term
- Dynamic analysis integration
- Cuckoo Sandbox wrapper
- API call monitoring
- Network traffic analysis
- Web dashboard

### Long Term
- Machine learning classification
- Automated unpacking
- Disassembly integration (Ghidra)
- Distributed analysis
- Real-time threat intelligence feeds

## ğŸ¯ Use Cases

1. **Incident Response**: Quick triage of suspicious files
2. **Malware Research**: Systematic sample cataloging
3. **Threat Intelligence**: IOC extraction for sharing
4. **SOC Operations**: Automated sample analysis
5. **Education**: Learning malware analysis techniques
6. **Forensics**: File analysis during investigations

## ğŸ¤ Contributing

This is an educational project demonstrating malware analysis concepts. Enhancements welcome:
- Additional file format parsers
- New YARA rule sets
- Improved threat scoring
- Dynamic analysis integration
- Additional IOC extraction

## ğŸ“„ License

MIT License - See [LICENSE](LICENSE) for details.

---

**Note**: This tool is designed for security research and education. Always analyze malware in isolated environments. Follow your organization's security policies and legal requirements when handling malicious software.

---

*Built as part of a cybersecurity portfolio to demonstrate malware analysis and reverse engineering skills.*
